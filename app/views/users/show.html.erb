<div class="user-container">
  <h1 class="visit-title"><%= @user.username %>'s Profile</h1>
  <% if @user == current_user %>
    <div class="card-product general-card">
      <% unless @user.photo.key.nil? %>
        <%= cl_image_tag @user.photo.key, class: "avatar" %>
      <% else %>
        <p><%= link_to "Add photo", edit_user_path(current_user) %></p>
      <% end %>
      <div class="card-product-infos">
        <h5><%= @user.email %></h5>
        <% if current_user.follow_requests.size > 0 %>
          <div class="follow-requests">
            <h3>Follow Requests</h3>
            <% current_user.follow_requests.each do |request| %>
              <div class="follow-request">
                <p><i class="fa-solid fa-user-plus"></i> <%= link_to request.followerable.email, user_path(request.followerable) %></p>
                <%= button_to "<i class='fa-solid fa-circle-check'></i>".html_safe, accept_path(request.followerable) %>
                <%= button_to "<i class='fa-solid fa-ban'></i>".html_safe, decline_path(request.followerable) %>
              </div>
            <% end %>
          </div>
        <% end %>
        <% if current_user.following.size > 0 %>
          <div class="follow-request">
            <% current_user.following.each do |user| %>
              <p><%= link_to user.email, user_path(user) %></p>
              <p><%= button_to "<i class='fa-solid fa-user-slash'></i>".html_safe, unfollow_path(user) %></p>
            <% end %>
          </div>
        <% end %>
        <p><%= link_to "Edit profile", edit_user_path(current_user) %></p>
        <p><%= link_to "Sign Out", destroy_user_session_path, data: { "turbo-method": :delete } %></p>
      </div>
    </div>
  <% else %>
    <div class="card-product">
      <% unless @user.photo.key.nil? %>
        <%= cl_image_tag @user.photo.key, class: "avatar" %>
      <% else %>
        <p><%= image_tag "https://i.imgur.com/djGIukc.png", class: "avatar" %></p>
      <% end %>
      <div class="card-product-infos">
        <% if current_user.following?(@user) %>
          <%= button_to "Unfollow", unfollow_path(@user) %>
        <% elsif current_user.sent_follow_request_to?(@user) %>
          <%= button_to "Cancel follow request", cancel_path(@user) %>
        <% else %>
          <%= button_to "Follow", follow_path(@user) %>
        <% end %>
        <p><%= link_to "My Profile", user_path(current_user) %></p>
      </div>
    </div>
  <% end %>
</div>
